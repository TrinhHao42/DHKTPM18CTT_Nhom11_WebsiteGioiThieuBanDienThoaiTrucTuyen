<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Test tracking - Enternal Rune Demo</title>
    <style>
        body {
            font-family: Inter, Arial, sans-serif;
            padding: 40px;
            background: #f7fafc;
            color: #111827;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        }

        .row {
            display: flex;
            gap: 12px;
        }

        .btn {
            background: #111827;
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            text-decoration: none;
        }

        .link {
            color: #2563eb;
        }

        header h1 {
            margin: 0 0 12px 0;
            font-weight: 700;
        }

        .info {
            margin-bottom: 12px;
            color: #374151;
        }

        .note {
            background: #f1f5f9;
            padding: 8px 10px;
            border-radius: 8px;
            color: #475569;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Demo: Tracking Test Page</h1>
            <p class="info">Trang này sẽ tải <code>tracker.js</code> từ backend và gửi pageview / events đến
                <code>/api/track</code>.
            </p>
            <div class="note">
                <strong>Lưu ý:</strong> Nếu bạn chạy frontend tại <code>http://localhost:3001</code> và backend tại
                <code>http://localhost:3002</code>, thì snippet mặc định sẽ hoạt động.
                Nếu bạn dùng ngrok hoặc deploy công khai, thay <code>TRACKER_URL</code> và <code>API_ENDPOINT</code>
                thành URL public tương ứng.
            </div>
        </header>

        <section style="margin-top:16px">
            <h2>Quick actions</h2>
            <div class="row" style="margin-top:8px">
                <a id="btn-click" class="btn">Click to trigger event</a>
                <a id="btn-nav" class="btn" href="#">Simulate SPA nav</a>
                <a id="link-out" class="link" target="_blank" href="https://example.com">Open outbound link (should
                    track)</a>
            </div>
        </section>

        <section style="margin-top:18px">
            <h2>Custom event sample</h2>
            <p>Click the button to send a custom event (purchase_completed).</p>
            <div style="margin-top:8px">
                <button id="purchase" data-analytics-event="purchase_completed" data-analytics-order-id="ORD-1234"
                    class="btn">Simulate purchase</button>
            </div>
        </section>

        <section style="margin-top:18px">
            <h2>Script configuration</h2>
            <pre style="background:#0f172a;color:#e6eef8;padding:10px;border-radius:6px;">
// Change these values if you use ngrok or public host
const TRACKER_URL = 'http://localhost:3002/tracker.js';
const SITE_ID = 'test-site-0001';
const API_ENDPOINT = 'http://localhost:3002/api/track';
      </pre>

            <p>Script below will load tracker and initialize it using the <code>data-analytics-site</code> attribute.
            </p>
        </section>

        <hr style="margin:18px 0" />

        <section>
            <h2>Usage / Demo</h2>
            <ol>
                <li>Start backend: <code>PORT=3002 node dist/index.js</code></li>
                <li>Start frontend dev on <code>http://localhost:3001</code> or serve this file using static server</li>
                <li>Open <code>http://localhost:3001/demo/test-tracker.html</code> (or the file url) in a browser and
                    click the buttons</li>
                <li>Check the backend logs (requestLogger) and Prisma Studio for created records</li>
            </ol>
        </section>

        <footer style="margin-top:18px;color:#6b7280">Note: track data will be created in your local Postgres DB under
            <code>user_sessions/page_views/events</code>
        </footer>
    </div>

    <!-- Loader snippet: change TRACKER_URL if using ngrok/public host -->
    <script>
        (function () {
            const TRACKER_URL = 'http://localhost:3002/tracker.js'; // change if needed
            const SITE_ID = 'test-site-0001';
            const API_ENDPOINT = 'http://localhost:3002/api/track';

            const s = document.createElement('script');
            s.src = TRACKER_URL;
            s.defer = true;
            s.onload = function () {
                setTimeout(() => {
                    if (window.analytics) {
                        window.analytics.config({ website: SITE_ID, apiEndpoint: API_ENDPOINT });
                        window.analytics.init();
                    }
                }, 50);
            };
            document.head.appendChild(s);

            // Bind demo buttons
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('btn-click').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (window.analytics) {
                        window.analytics.track('demo_button_click', { label: 'btn-click' });
                        alert('Demo event sent');
                    } else alert('Tracker not loaded');
                });

                document.getElementById('btn-nav').addEventListener('click', (e) => {
                    e.preventDefault();
                    // simulate SPA navigation (pushState)
                    history.pushState({}, '', '/demo/next');
                    document.title = 'Demo - Next Page';
                    setTimeout(() => window.analytics && window.analytics.page(), 100);
                    alert('Simulated SPA route change');
                });

                document.getElementById('purchase').addEventListener('click', () => {
                    if (window.analytics) {
                        window.analytics.track('purchase_completed', { orderId: 'ORD-1234', revenue: 99.99 });
                        alert('Purchase event sent');
                    }
                });
            });
        })();
    </script>
</body>

</html>